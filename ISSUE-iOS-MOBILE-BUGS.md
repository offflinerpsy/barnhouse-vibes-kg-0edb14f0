# üêõ CRITICAL BUG: iOS Safari Mobile ‚Äî Modal z-index / Auto-lock –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**Severity:** CRITICAL ‚Äî —Å–∞–π—Ç –Ω–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö  
**Affected:** iOS Safari (iPhone), Chrome Android (Samsung)  
**URL:** https://era-home.kg  
**Repo:** https://github.com/offflinerpsy/barnhouse-vibes-kg-0edb14f0

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –≤ —Å–µ–∫—Ü–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ (`#catalog`) –¥–≤–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º—ã:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: ContactModal –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ü–û–î –∫–∞—Ç–∞–ª–æ–≥–æ–º

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ó–∞—è–≤–∫–∞" –≤ –º–æ–±–∏–ª—å–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ, –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ `ContactModal` –ø–æ—è–≤–ª—è–µ—Ç—Å—è **–ø–æ–¥** —Å–µ–∫—Ü–∏–µ–π –∫–∞—Ç–∞–ª–æ–≥–∞, –∞ –Ω–µ –ø–æ–≤–µ—Ä—Ö –Ω–µ—ë.

**–ü—Ä–∏—á–∏–Ω–∞ (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ):**  
–ö–∞—Ç–∞–ª–æ–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `position: fixed` + `z-index: 100` –ø—Ä–∏ –∞–≤—Ç–æ—Ñ–∏–∫—Å–∞—Ü–∏–∏. –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π **stacking context**. –î–∞–∂–µ –µ—Å–ª–∏ `ContactModal` —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —á–µ—Ä–µ–∑ `createPortal` –≤ `document.body`, iOS Safari –Ω–µ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –µ–≥–æ –Ω–∞–¥ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º stacking context.

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Auto-lock –∫–∞—Ç–∞–ª–æ–≥–∞ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

–ü—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –¥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ –æ–Ω –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ "–∑–∞—Ö–≤–∞—Ç—ã–≤–∞—Ç—å" —ç–∫—Ä–∞–Ω (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `IntersectionObserver` —Å threshold 0.3. –ù–∞ iOS Safari observer –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç.

**–ü—Ä–∏—á–∏–Ω–∞ (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ):**  
`IntersectionObserver` –Ω–∞ iOS Safari –∏–º–µ–µ—Ç –±–∞–≥–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–º–∏ CSS transforms –∏–ª–∏ –Ω–∞—Ö–æ–¥—è—â–∏–º–∏—Å—è –≤ scroll-snap –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö.

---

## üéØ –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

1. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ó–∞—è–≤–∫–∞" ‚Äî —Ñ–æ—Ä–º–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è **–ø–æ–≤–µ—Ä—Ö** –∫–∞—Ç–∞–ª–æ–≥–∞
2. –ü—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –¥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ (30% –≤–∏–¥–∏–º–æ—Å—Ç–∏) ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–≤–∞–π–ø–∞—Ç—å –º–æ–¥–µ–ª–∏, –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –≥–∞–ª–µ—Ä–µ—é, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞—è–≤–∫—É
4. –ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞" —Å–∫—Ä–æ–ª–ª–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å–µ–∫—Ü–∏–∏

---

## üîß –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–¥–∞

### –§–∞–π–ª: `src/components/landing/CatalogAppView.tsx`

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):**

```tsx
// –ü–æ–ø—ã—Ç–∫–∞ –≤—Å—Ç—Ä–æ–∏—Ç—å —Ñ–æ—Ä–º—É –≤–Ω—É—Ç—Ä—å –∫–∞—Ç–∞–ª–æ–≥–∞ (inline form)
// –ò–¥–µ—è: –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –í–ù–£–¢–†–ò section, –æ–Ω–∞ –≤ —Ç–æ–º –∂–µ stacking context

interface CatalogAppViewProps {
  onClose?: () => void;
  // contactOpen –∏ onContactChange –£–î–ê–õ–ï–ù–´
}

// –î–æ–±–∞–≤–ª–µ–Ω InlineMobileContactForm –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (—Å—Ç—Ä–æ–∫–∏ 710-907)
function InlineMobileContactForm({ modelName, modelArea, onClose, onSuccess }) {
  // –§–æ—Ä–º–∞ —Å position: absolute inset-0 z-[100]
}

// –î–æ–±–∞–≤–ª–µ–Ω state –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ñ–æ—Ä–º—ã
const [showContactForm, setShowContactForm] = useState(false);
const [showSuccessScreen, setShowSuccessScreen] = useState(false);

// –£–î–ê–õ–Å–ù –≤–µ—Å—å –∫–æ–¥ –∞–≤—Ç–æ-—Ñ–∏–∫—Å–∞—Ü–∏–∏ (IntersectionObserver, scroll listeners)
// –ó–∞–º–µ–Ω—ë–Ω –Ω–∞ –ø—Ä–æ—Å—Ç—É—é —Å–µ–∫—Ü–∏—é —Å CSS scroll-snap
```

**–¢–µ–∫—É—â–∏–π —Ä–µ–Ω–¥–µ—Ä —Å–µ–∫—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ ~970-990):**
```tsx
<section 
  ref={catalogRef}
  id="catalog"
  className="relative bg-charcoal text-white overflow-hidden h-[100dvh] snap-start snap-always"
  style={{ overscrollBehavior: 'contain' }}
>
```

**Inline —Ñ–æ—Ä–º–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ (—Å—Ç—Ä–æ–∫–∏ ~1295-1310):**
```tsx
<AnimatePresence>
  {showContactForm && !showSuccessScreen && (
    <InlineMobileContactForm
      modelName={currentModel.name}
      modelArea={currentModel.area}
      onClose={() => setShowContactForm(false)}
      onSuccess={() => {
        setShowContactForm(false);
        setShowSuccessScreen(true);
      }}
    />
  )}
</AnimatePresence>
```

### –§–∞–π–ª: `src/components/landing/Catalog.tsx`

**–°—Ç—Ä–æ–∫–∏ ~1613-1619:**
```tsx
if (isMobile) {
  return (
    <section id="catalog" className="relative">
      <CatalogAppView />
    </section>
  );
}
```

### –§–∞–π–ª: `src/components/landing/ContactModal.tsx`

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç `createPortal` –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞ –≤ `#portal-root` –∏–ª–∏ `document.body`. –ù–∞ iOS Safari —ç—Ç–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç –≤—ã–π—Ç–∏ –∏–∑ stacking context —Ä–æ–¥–∏—Ç–µ–ª—è.

---

## üß™ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- **iPhone** (–ª—é–±–æ–π —Å iOS 15+) ‚Äî Safari
- **Samsung Galaxy** (S22 –∏–ª–∏ –∞–Ω–∞–ª–æ–≥) ‚Äî Chrome / Samsung Internet

---

## üí° –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç A: –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–∞

–£–±—Ä–∞—Ç—å `position: fixed` –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ CSS scroll-snap –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

### –í–∞—Ä–∏–∞–Ω—Ç B: Native dialog element

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `<dialog>` —ç–ª–µ–º–µ–Ω—Ç —Å `showModal()` ‚Äî –æ–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤ top layer.

### –í–∞—Ä–∏–∞–Ω—Ç C: –û—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è —Ñ–æ—Ä–º—ã

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ó–∞—è–≤–∫–∞" ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `/contact?model=X` –≤–º–µ—Å—Ç–æ –º–æ–¥–∞–ª–∫–∏.

### –í–∞—Ä–∏–∞–Ω—Ç D: Debug –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

–ü–æ–¥–∫–ª—é—á–∏—Ç—å iPhone —á–µ—Ä–µ–∑ Safari Web Inspector –∏ –æ—Ç–ª–∞–¥–∏—Ç—å z-index/stacking context –Ω–∞ –º–µ—Å—Ç–µ.

---

## üìÅ –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

```
src/components/landing/CatalogAppView.tsx  ‚Äî –ú–æ–±–∏–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ (1332 —Å—Ç—Ä–æ–∫–∏)
src/components/landing/Catalog.tsx         ‚Äî Desktop + —Ä–æ—É—Ç–∏–Ω–≥ –Ω–∞ mobile
src/components/landing/ContactModal.tsx    ‚Äî –ú–æ–¥–∞–ª–∫–∞ (318 —Å—Ç—Ä–æ–∫)
src/pages/TestModals.tsx                   ‚Äî –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ /test-modals
index.html                                  ‚Äî Portal root (#portal-root)
```

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Stacking Context (MDN)](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_positioned_layout/Understanding_z-index/Stacking_context)
- [IntersectionObserver iOS bugs](https://github.com/nickersoft/push.js/issues/235)
- [CSS Scroll Snap](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_scroll_snap)

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

**–ö–æ–¥ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω—ë–Ω, –Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –ù–ï —Ä–µ—à–µ–Ω–∞!**

–ë—ã–ª–∏ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
1. `createPortal` –≤ document.body ‚Äî –Ω–µ –ø–æ–º–æ–≥–ª–æ
2. IntersectionObserver —Å iOS detection + scroll fallback ‚Äî –Ω–µ –ø–æ–º–æ–≥–ª–æ
3. Inline form –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ ‚Äî –Ω–µ –ø–æ–º–æ–≥–ª–æ (–∏–ª–∏ –Ω–µ –∑–∞–¥–µ–ø–ª–æ–∏–ª–æ—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

–¢—Ä–µ–±—É–µ—Ç—Å—è:
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–¥ —Ä–µ–∞–ª—å–Ω–æ –∑–∞–¥–µ–ø–ª–æ–µ–Ω (—Å—Ä–∞–≤–Ω–∏—Ç—å —Ö–µ—à–∏ JS —Ñ–∞–π–ª–æ–≤)
3. –ù–∞–π—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –î–û –¥–µ–ø–ª–æ—è

---

## üèÉ –ö–∞–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏

1. –û—Ç–∫—Ä—ã—Ç—å https://era-home.kg –Ω–∞ iPhone (Safari)
2. –ü—Ä–æ—Å–∫—Ä–æ–ª–ª–∏—Ç—å –¥–æ —Å–µ–∫—Ü–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞
3. –ù–∞–∂–∞—Ç—å –æ—Ä–∞–Ω–∂–µ–≤—É—é –∫–Ω–æ–ø–∫—É "–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É" –∏–ª–∏ –∫–Ω–æ–ø–∫—É "–ó–∞—è–≤–∫–∞" –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
4. **–û–∂–∏–¥–∞–Ω–∏–µ:** —Ñ–æ—Ä–º–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö
5. **–§–∞–∫—Ç:** —Ñ–æ—Ä–º–∞ –Ω–µ –≤–∏–¥–Ω–∞ (–ø–æ–¥ –∫–∞—Ç–∞–ª–æ–≥–æ–º) –∏–ª–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–æ–æ–±—â–µ
